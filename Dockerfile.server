FROM node:22-alpine

WORKDIR /app

# Install pnpm
RUN npm install -g pnpm

# Copy package files
COPY server/package.json server/pnpm-lock.yaml ./

# Install dependencies without frozen-lockfile flag
RUN pnpm install

# Copy server code
COPY server .

# Build TypeScript code
RUN pnpm build

ENV NODE_ENV production

EXPOSE 8000

CMD ["node", "dist/index.js"] 
